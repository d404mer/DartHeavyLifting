"""
Конфигурация параметров для отслеживания позы и штанги
"""

# ============================================================================
# ПАРАМЕТРЫ ВИДЕО
# ============================================================================
VIDEO_WIDTH = 1920
# Ширина видео в пикселях. Устанавливается при инициализации камеры.
# Если камера не поддерживает это разрешение, будет использовано максимальное доступное.

VIDEO_HEIGHT = 1080
# Высота видео в пикселях. Устанавливается при инициализации камеры.
# Если камера не поддерживает это разрешение, будет использовано максимальное доступное.

TARGET_FPS = 50
# Целевой FPS (кадров в секунду). Устанавливается при инициализации камеры.
# Фактический FPS может отличаться в зависимости от возможностей камеры.

# Путь к ffmpeg (должен быть с поддержкой DeckLink при использовании SDI)
FFMPEG_PATH = "ffmpeg"
# Если ffmpeg установлен не в PATH, укажите полный путь, например:
# FFMPEG_PATH = r"C:/ffmpeg/bin/ffmpeg.exe"

# Значения по умолчанию для устройств DeckLink при захвате через ffmpeg
DECKLINK_DEFAULT_DEVICE = None  # Например: "DeckLink Mini Recorder 4K"
DECKLINK_DEFAULT_FORMAT_CODE = None  # Например: "hp50"
DECKLINK_DEFAULT_PIXEL_FORMAT = "bgr24"  # Альтернативы: "yuv420p", "uyvy422"

# ============================================================================
# ПАРАМЕТРЫ UDP ОТПРАВКИ
# ============================================================================
UDP_HOST = "127.0.0.1"
# IP адрес получателя UDP пакетов. "127.0.0.1" = локальный компьютер.
# Для отправки на другой компьютер укажите его IP адрес.

UDP_PORT = 5005
# Порт для отправки UDP пакетов. Должен совпадать с портом получателя (Unreal Engine).

# ============================================================================
# ПАРАМЕТРЫ MEDIAPIPE POSE (ОБНАРУЖЕНИЕ ПОЗЫ)
# ============================================================================
MIN_DETECTION_CONFIDENCE = 0.5
# Минимальная уверенность для обнаружения позы (0.0-1.0).
# Больше значение = строже обнаружение, меньше ложных срабатываний, но может пропускать позу.
# Меньше значение = мягче обнаружение, находит позу чаще, но может быть больше ошибок.

MIN_TRACKING_CONFIDENCE = 0.5
# Минимальная уверенность для отслеживания позы (0.0-1.0).
# Больше значение = более стабильное отслеживание, но может терять при быстрых движениях.
# Меньше значение = лучше отслеживает быстрые движения, но может быть менее стабильно.

# ============================================================================
# ТРЕКИНГ ПОЗЫ (ТЕЛА)
# ============================================================================
ENABLE_POSE_TRACKING = False
# Включить/выключить трекинг позы (тела) полностью.
# True = обрабатывается поза через MediaPipe, визуализируются ноги, отправляются данные через UDP.
# False = поза НЕ обрабатывается вообще (экономия ресурсов CPU/GPU), только трекинг штанги.
# Можно отключить клавишей '1' для максимальной производительности.

ENABLE_LEG_TRACKING = True
# Включить/выключить трекинг ног (работает только если ENABLE_POSE_TRACKING = True).
# True = визуализируются ноги, отправляются данные о коленях через UDP.
# False = ноги не визуализируются, данные о коленях не отправляются.
# Можно переключить клавишей 'l'.

# ============================================================================
# ПАРАМЕТРЫ ОБНАРУЖЕНИЯ ШТАНГИ (ОКРУЖНОСТЬ)
# ============================================================================

# Размер окружности штанги (в пикселях)
BARBELL_CIRCLE_MIN_RADIUS = 50
# Минимальный радиус окружности штанги в пикселях.
# Уменьшите если штанга маленькая на видео (далеко от камеры).
# Настраивается клавишами 't'/'y'.

BARBELL_CIRCLE_MAX_RADIUS = 100
# Максимальный радиус окружности штанги в пикселях.
# Увеличьте если штанга большая на видео (близко к камере).
# Настраивается клавишами 'u'/'i'.

# Параметры алгоритма HoughCircles (обнаружение окружностей)
BARBELL_CIRCLE_PARAM1 = 50
# Верхний порог детектора границ (30-200).
# Больше значение = строже обнаружение границ, меньше ложных окружностей.
# Меньше значение = мягче обнаружение, находит больше окружностей (включая шум).
# Настраивается клавишами 'e'/'r'.

BARBELL_CIRCLE_PARAM2 = 50
# Порог аккумулятора для обнаружения окружностей (10-50).
# Это ОСНОВНОЙ параметр для настройки! Меньше значение = находит больше окружностей.
# Рекомендуется начинать с 30 и уменьшать ('s') если штанга не находится.
# Настраивается клавишами 'w'/'s'.

BARBELL_CIRCLE_MIN_DIST = 50
# Минимальное расстояние между центрами окружностей в пикселях.
# Больше значение = окружности должны быть дальше друг от друга.
# Уменьшите если штанга не находится из-за близких окружностей.
# Настраивается клавишами 'o'/'p'.

BARBELL_CIRCLE_DP = 1
# Обратное разрешение аккумулятора (1-2, обычно 1).
# 1 = полное разрешение, 2 = половина разрешения (быстрее, но менее точно).
# Обычно оставляйте 1.

# Параметры выбора лучшей окружности из найденных
BARBELL_PREFER_LARGER_RADIUS = True
# Предпочитать окружности с большим радиусом (ближе к камере).
# True = выбирает большую окружность (обычно это штанга).
# False = выбирает среднюю окружность.

BARBELL_RADIUS_STABILITY_WEIGHT = 0.3
# Вес стабильности радиуса при выборе окружности (0.0-1.0).
# Больше значение = предпочитает окружности с похожим радиусом (стабильность размера).
# Используется в комбинации с BARBELL_POSITION_STABILITY_WEIGHT.

BARBELL_POSITION_STABILITY_WEIGHT = 0.9
# Вес стабильности позиции при выборе окружности (0.0-1.0).
# Больше значение = предпочитает окружности близкие к предыдущей позиции (стабильность движения).
# Используется в комбинации с BARBELL_RADIUS_STABILITY_WEIGHT.
# Сумма с BARBELL_RADIUS_STABILITY_WEIGHT не должна превышать 1.0.

# Параметры предобработки изображения перед обнаружением окружностей
BARBELL_BLUR_SIZE = 9
# Размер ядра размытия (5, 7, 9, 11, 13, 15 - только нечетные числа).
# Больше значение = больше размытие, меньше шума, но может потерять детали.
# Уменьшите если штанга четкая, увеличьте если много шума.
# Настраивается клавишами 'k'/'j'.

BARBELL_BLUR_SIGMA = 2
# Сигма (стандартное отклонение) размытия (1.0-5.0).
# Больше значение = больше размытие.
# Обычно используется 1-2 для четкого видео, 3-5 для шумного.
# Настраивается клавишами 'k'/'j'.

# Дополнительная предобработка для сложного освещения
BARBELL_ENABLE_CLAHE = True
# Включить локальное выравнивание гистограммы для повышения контраста (рекомендуется для темных/пересвеченных сцен)
BARBELL_CLAHE_CLIP_LIMIT = 2.0
BARBELL_CLAHE_TILE_GRID_SIZE = (8, 8)

BARBELL_ENABLE_CONTOUR_FALLBACK = True
# Включить запасной метод поиска по контурам при провале HoughCircles
BARBELL_CANNY_THRESHOLD1 = 50
BARBELL_CANNY_THRESHOLD2 = 150
BARBELL_MIN_CIRCULARITY = 0.6
# Минимальная «круглость» (0-1) при оценке контура через отношение площади к площади описанной окружности

# Ограничение резких прыжков и нестабильности
BARBELL_MAX_JUMP_PIXELS = 120
# Максимально допустимый скачок центра между кадрами; больше — считается выбросом и игнорируется
BARBELL_MAX_RADIUS_DELTA = 25
# Максимально допустимое изменение радиуса между кадрами

# Область поиска штанги
BARBELL_USE_SEARCH_REGION = True
# Использовать область поиска на основе положения рук спортсмена.
# True = ищет штангу только между руками (быстрее, точнее, но требует видимые руки).
# False = ищет штангу по всему кадру (медленнее, но работает без рук).

# Режим отладки
BARBELL_DEBUG_MODE = False
# Показывать процесс обнаружения штанги.
# True = показывает желтый прямоугольник (область поиска) и желтые окружности (все найденные).
# False = показывает только финальный путь штанги.
# Переключается клавишей 'd'.

# ============================================================================
# ИСТОЧНИК ВИДЕО
# ============================================================================
DEBUG_VIDEO_PATH = None
# Путь к видео файлу для отладки.
# None = использовать камеру (CAMERA_ID).
# Можно указать относительный или абсолютный путь.
# Примеры: "test_video.mp4", "videos/workout.mp4", "C:/Videos/barbell.mp4"

CAMERA_ID = 0
# ID камеры для захвата видео.
# 0 = первая камера, 1 = вторая камера, и т.д.
# Для карты захвата обычно используется другой индекс (1, 2, 3...).

# ============================================================================
# ВИЗУАЛИЗАЦИЯ
# ============================================================================
COLOR_BARBELL_PATH = (13, 81, 209)
# Цвет пути штанги в формате BGR (Blue, Green, Red).
# (0, 255, 0) = зеленый. rgb(209, 13, 49) 13, 81, 209)

COLOR_KNEE_JOINT = (255, 0, 0)
# Цвет коленей в формате BGR.
# (255, 0, 0) = синий.

COLOR_LEG_BONE = (0, 0, 255)
# Цвет костей ног (линий скелета) в формате BGR.
# (0, 0, 255) = красный.

COLOR_JOINT = (255, 255, 0)
# Цвет других суставов (бедра, лодыжки) в формате BGR.
# (255, 255, 0) = голубой.

JOINT_RADIUS = 5
# Радиус точек суставов в пикселях.
# Колени рисуются с радиусом JOINT_RADIUS + 2.

LINE_THICKNESS = 5
# Толщина линий скелета и пути штанги в пикселях.

# Параметры визуализации пути штанги
BARBELL_PATH_OFFSET_X = 480
# Смещение пути штанги вправо в пикселях

BARBELL_PATH_COLOR = (0, 0, 255)
# Цвет пути штанги в формате BGR (красный)

BARBELL_PATH_OPACITY = 1.0
# Непрозрачность пути штанги (1.0 = 100%, 0.0 = полностью прозрачный)

BARBELL_DASH_COLOR = (255, 255, 255)
# Цвет пунктирной линии в формате BGR (белый)

BARBELL_DASH_OPACITY = 0.5
# Непрозрачность пунктирной линии (0.5 = 50%, 1.0 = 100%)

BARBELL_DASH_LENGTH = 2
# Длина сегмента пунктира в пикселях

BARBELL_DASH_GAP = 15
# Промежуток между сегментами пунктира в пикселях

BARBELL_DASH_THICKNESS = 5
# Толщина пунктирной линии в пикселях

# ============================================================================
# ДРУГИЕ ПАРАМЕТРЫ
# ============================================================================
MAX_PATH_POINTS = 1000
# Максимальное количество точек пути штанги для хранения.
# При превышении старые точки удаляются (FIFO очередь).
# Больше значение = хранится больше истории пути, но больше потребление памяти.

# Сглаживание траектории (визуализация)
PATH_SMOOTHING_ENABLED = True
# Включить сглаживание траектории штанги при отрисовке
# True = путь рисуется плавно, даже если детектирование дрожит
# False = путь рисуется точно по точкам детектирования
PATH_SMOOTHING_METHOD = "moving_average"
# "savgol" | "moving_average" | "none"
# "savgol" - фильтр Савицкого-Голея (рекомендуется, очень плавно)
# "moving_average" - скользящее среднее (проще, быстрее)
# "none" - без сглаживания
PATH_SAVGOL_WINDOW = 15  # окно должно быть нечетным и >=5
# Больше значение = более плавный путь, но больше задержка визуализации
# Рекомендуется: 9-21 (9 = менее плавно, 21 = очень плавно)
PATH_SAVGOL_POLYORDER = 2
# Полином для фильтра Савицкого–Голея (обычно 2-3)
# 2 = более плавно, 3 = точнее сохраняет форму

# Параметры для метода moving_average (если используется)
PATH_MOVING_AVERAGE_WINDOW = 7  # окно скользящего среднего (нечетное, >=3)
# Больше значение = более плавный путь

BARBELL_SMOOTHING_FACTOR = 0.0
# Коэффициент EMA сглаживания текущего положения штанги (0.0 = без задержки)

# Управление задержкой и устойчивостью трекера штанги
BARBELL_USE_KALMAN = False
# Использовать Калман для сглаживания/предсказаний (True добавляет плавность, но немного задержки)
BARBELL_REJECT_OUTLIERS = False
# Отбрасывать «скачки» по положению/радиусу (True повышает стабильность, может добавить задержку)

# Легкое подавление микродрожания (минимальная задержка ~1 кадр)
BARBELL_ANTI_JITTER = True
BARBELL_ANTI_JITTER_WINDOW = 3  # окно медианного фильтра (3 или 5)
BARBELL_ANTI_JITTER_MAX_RANGE = 6  # пикселей; применять медиану только если движения мелкие

# Низкозадержочное сглаживание «2-tap» при малой скорости
BARBELL_ANTI_JITTER_2TAP = True
BARBELL_ANTI_JITTER_SPEED_THRESH_LOW = 1.5   # px/кадр: ниже — просто держим предыдущую
BARBELL_ANTI_JITTER_SPEED_THRESH_HIGH = 5.0  # px/кадр: ниже этого — усредняем prev/current
BARBELL_ANTI_JITTER_2TAP_WEIGHT = 0.65       # вес текущего измерения при 2-tap

# Усиленная стабилизация по горизонтали (без задержки при заметном движении)
BARBELL_X_JITTER_LOCK = True
BARBELL_X_LOCK_SPEED = 6.0        # px/кадр: ниже — слегка «прилипать» по X
BARBELL_X_LOCK_WEIGHT = 0.6       # вес предыдущего по X при низкой скорости

# При выборе окружности штрафовать резкие горизонтальные скачки
BARBELL_X_STABILITY_GAIN = 3    # >1 усиливает стабильность по X в выборе лучшей окружности

# Уточнение центра окружности в кольцевой области (уменьшает дрожание)
BARBELL_REFINE_CENTER = False
BARBELL_REFINE_RING_INNER = 0.6   # доля радиуса для внутреннего радиуса кольца
BARBELL_REFINE_RING_OUTER = 1.3   # доля радиуса для внешнего радиуса кольца
BARBELL_REFINE_CANNY_T1 = 60
BARBELL_REFINE_CANNY_T2 = 180

# Авто-очистка пути при простое
BARBELL_IDLE_CLEAR_SECONDS = 4.5   # сек без движения до очистки пути
BARBELL_IDLE_MIN_MOVE_PX = 8       # пикселей: меньше этого считаем как «не двигается»

# Руководство по настройке обнаружения штанги

## Проблемы и решения

### Штанга не обнаруживается вообще

1. **Уменьшите param2** (порог аккумулятора)
   - В `config.py`: `BARBELL_CIRCLE_PARAM2 = 20` (вместо 30)
   - Или нажмите `-` во время работы
   - Меньше значение = находит больше окружностей (включая ложные)

2. **Проверьте размер окружности**
   - Увеличьте `BARBELL_CIRCLE_MAX_RADIUS` если штанга большая
   - Уменьшите `BARBELL_CIRCLE_MIN_RADIUS` если штанга маленькая
   - Используйте клавиши `[` и `]` для настройки в реальном времени

3. **Включите режим отладки**
   - В `config.py`: `BARBELL_DEBUG_MODE = True`
   - Или нажмите `d` во время работы
   - Вы увидите желтые окружности - все найденные окружности

### Обнаруживается слишком много ложных окружностей

1. **Увеличьте param2** (порог аккумулятора)
   - В `config.py`: `BARBELL_CIRCLE_PARAM2 = 40` (вместо 30)
   - Или нажмите `+` во время работы
   - Больше значение = строже обнаружение

2. **Увеличьте param1** (верхний порог детектора)
   - В `config.py`: `BARBELL_CIRCLE_PARAM1 = 100`
   - Более строгий детектор границ

3. **Уменьшите область поиска**
   - В `config.py`: `BARBELL_USE_SEARCH_REGION = True`
   - Поиск только между руками спортсмена

### Штанга обнаруживается нестабильно (пропадает)

1. **Уменьшите param2** (чтобы находить больше окружностей)
2. **Увеличьте сглаживание**
   - В `main.py` в `OptimizedBarbellTracker.__init__`: `smoothing_factor=0.8` (вместо 0.7)

3. **Увеличьте размытие**
   - В `config.py`: `BARBELL_BLUR_SIZE = 11`, `BARBELL_BLUR_SIGMA = 3`

### Штанга обнаруживается не в том месте

1. **Отключите область поиска**
   - В `config.py`: `BARBELL_USE_SEARCH_REGION = False`
   - Поиск по всему кадру

2. **Увеличьте minDist** (минимальное расстояние между окружностями)
   - В `config.py`: `BARBELL_CIRCLE_MIN_DIST = 100`

## Параметры HoughCircles

### param1 (верхний порог детектора)
- **Диапазон**: 50-200
- **По умолчанию**: 50
- **Больше** = строже обнаружение границ
- **Меньше** = находит больше границ (включая шум)

### param2 (порог аккумулятора)
- **Диапазон**: 10-50
- **По умолчанию**: 30
- **Больше** = строже, находит только четкие окружности
- **Меньше** = мягче, находит больше окружностей (включая нечеткие)
- **Настраивается в реальном времени**: `+` / `-`

### minRadius / maxRadius
- **Диапазон**: зависит от размера штанги на видео
- **По умолчанию**: 20-100 пикселей
- **Настраивается в реальном времени**: `[` / `]`

### minDist (минимальное расстояние)
- **Диапазон**: 30-200
- **По умолчанию**: 50
- **Больше** = окружности должны быть дальше друг от друга

## Параметры предобработки

### BLUR_SIZE (размер размытия)
- **Диапазон**: 5, 7, 9, 11, 13 (только нечетные)
- **По умолчанию**: 9
- **Больше** = больше размытие, меньше шума, но может потерять детали

### BLUR_SIGMA (сигма размытия)
- **Диапазон**: 1-5
- **По умолчанию**: 2
- **Больше** = больше размытие

## Режим отладки

Включите `BARBELL_DEBUG_MODE = True` в `config.py` или нажмите `d` во время работы.

Вы увидите:
- **Желтый прямоугольник** - область поиска (если включена)
- **Желтые окружности** - все найденные окружности
- **Зеленая окружность** - выбранная штанга

## Быстрая настройка

1. Запустите программу с видео файлом
2. Нажмите `d` для включения отладки
3. Нажимайте `-` пока не увидите желтые окружности на штанге
4. Если слишком много окружностей - нажимайте `+` пока не останется нужная
5. Настройте размеры `[` и `]` если нужно
6. Скопируйте значения из консоли в `config.py`

## Примеры настроек

### Для большой штанги (близко к камере)
```python
BARBELL_CIRCLE_MIN_RADIUS = 50
BARBELL_CIRCLE_MAX_RADIUS = 150
BARBELL_CIRCLE_PARAM2 = 35
```

### Для маленькой штанги (далеко от камеры)
```python
BARBELL_CIRCLE_MIN_RADIUS = 10
BARBELL_CIRCLE_MAX_RADIUS = 50
BARBELL_CIRCLE_PARAM2 = 25
```

### Для нечеткой/размытой штанги
```python
BARBELL_CIRCLE_PARAM2 = 20
BARBELL_BLUR_SIZE = 11
BARBELL_BLUR_SIGMA = 3
```

### Для четкой/контрастной штанги
```python
BARBELL_CIRCLE_PARAM2 = 40
BARBELL_BLUR_SIZE = 7
BARBELL_BLUR_SIGMA = 1
```

